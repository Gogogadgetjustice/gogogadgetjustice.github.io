<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Palette Swapper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .controls {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        select, input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .drop-zone {
            border: 3px dashed #667eea;
            border-radius: 8px;
            padding: 60px 20px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .drop-zone:hover, .drop-zone.dragover {
            background: #e8ebff;
            border-color: #764ba2;
        }
        
        .drop-zone p {
            color: #667eea;
            font-size: 18px;
            font-weight: 600;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #764ba2;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .preview-box {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }
        
        .preview-box h3 {
            margin-bottom: 10px;
            color: #555;
            font-size: 16px;
        }
        
        .preview-box img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        
        .status {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .hidden {
            display: none;
        }
        
        .palette-preview {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .palette-color {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #ddd;
        }
        
        progress {
            width: 100%;
            height: 30px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Retro Console Palette Swapper</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="console">Console:</label>
                <select id="console">
                    <option value="Game Boy">Game Boy</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="palette">Palette:</label>
                <select id="palette">
                    <option value="Original">Original</option>
                </select>
            </div>
            
            <div class="palette-preview" id="palettePreview"></div>
        </div>
        
        <div class="drop-zone" id="dropZone">
            <p>üìÅ Drag & drop image(s) here or click to select</p>
            <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
        </div>
        
        <div class="buttons">
            <button id="convertBtn" disabled>Convert Images</button>
            <button id="downloadBtn" class="hidden">Download All</button>
        </div>
        
        <progress id="progress" value="0" max="100" class="hidden"></progress>
        
        <div id="status" class="status hidden"></div>
        
        <div class="preview-container hidden" id="previewContainer">
            <div class="preview-box">
                <h3>Original</h3>
                <img id="originalPreview" src="" alt="Original">
            </div>
            <div class="preview-box">
                <h3>Converted</h3>
                <img id="convertedPreview" src="" alt="Converted">
            </div>
        </div>
    </div>

    <script>
        // Palette data
        const PALETTES = {
            "Game Boy": {
                "Original": {
                    colors: ['#071821', '#86c06c', '#e0f8cf', '#65ff00'],
                    description: "4 shades of green-gray"
                },
                "Pocket": {
                    colors: ['#000000', '#555555', '#AAAAAA', '#FFFFFF'],
                    description: "4 shades of gray"
                },
                "Light": {
                    colors: ['#001A1A', '#305050', '#86A2A2', '#C7DEDE'],
                    description: "4 shades of blue-gray"
                }
            },
            "1-Bits": {
                "Nokia3310": {
                    colors: ['#212c28', '#72a488'],
                    description: "Nokia 3310"
                },
                "NOIRE TRUTH": {
                    colors: ['#c6baac', '#1e1c32'],
                    description: "NOIRE TRUTH"
                },
                "IBM 8503": {
                    colors: ['#2e3037', '#ebe5ce'],
                    description: "IBM 8503"
                },
                "MACPAINT": {
                    colors: ['#8bc8fe', '#051b2c'],
                    description: "MACPAINT"
                },
                "Roboto": {
                    colors: ['#0a2e44', '#fcffcc'],
                    description: "Roboto"
                },
                "Station Defenders": {
                    colors: ['#17141c', '#a692b0'],
                    description: "Station Defenders"
                },
                "PAPERBACK": {
                    colors: ['#b8c2b9', '#382b26'],
                    description: "PAPERBACK"
                },
                "PIXELINK": {
                    colors: ['#3e232c', '#edf6d6'],
                    description: "PIXELINK"
                },
                "Postapoc Sunset": {
                    colors: ['#1d0f44', '#f44e38'],
                    description: "Postapoc Sunset"
                },
                "PaperPaper": {
                    colors: ['#3e3e3e', '#f6e7c1'],
                    description: "PaperPaper"
                },
                "Chasing Light": {
                    colors: ['#ffff02', '#000000'],
                    description: "Chasing Light"
                },
                "Macao12": {
                    colors: ['#fff2df', '#ef243a'],
                    description: "Macao12"
                },
                "generic milk": {
                    colors: ['#f5f4e9', '#5b88e2'],
                    description: "generic milk"
                },
                "Y Neutral Green": {
                    colors: ['#004c3d', '#ffeaf9'],
                    description: "Y Neutral Green"
                },
                "Casio Basic": {
                    colors: ['#000000', '#83b07e'],
                    description: "Casio Basic"
                },
                "1 Bit Chill": {
                    colors: ['#110c22', '#c3dce5'],
                    description: "1 Bit Chill"
                },
                "Manga 1bit": {
                    colors: ['#171219', '#f2fbeb'],
                    description: "Manga 1bit"
                },
                "GatoRoboto": {
                    colors: ['#363636', '#ececec'],
                    description: "GatoRoboto"
                },
                "4Am": {
                    colors: ['#e6d4be', '#352b30'],
                    description: "4Am"
                },
                "1bit Blue": {
                    colors: ['#0d132a', '#adc3e8'],
                    description: "1bit Blue"
                },
                "1bit Nostalgia": {
                    colors: ['#2e253d', '#b0b0b0'],
                    description: "1bit Nostalgia"
                },
                "basicblackwhite": {
                    colors: ['#000000', '#ffffff'],
                    description: "basicblackwhite"
                },
                "endgame": {
                    colors: ['#1b1233', '#dcf29d'],
                    description: "endgame"
                },
                "NOTE-2c": {
                    colors: ['#222a3d', '#edf2e2'],
                    description: "NOTE-2c"
                },
                "Flowerrs&Asbestos": {
                    colors: ['#c62b69', '#edf4ff'],
                    description: "Flowerrs&Asbestos"
                },
                "Coffee Calm": {
                    colors: ['#211912', '#d9d9d9'],
                    description: "Coffee Calm"
                },
                "Funky Jam Red": {
                    colors: ['#920244', '#fec28c'],
                    description: "Funky Jam Red"
                },
                "Gato": {
                    colors: ['#282828', '#a9a9a9'],
                    description: "Gato"
                },
                "1bitpepperpalette": {
                    colors: ['#100101', '#ebb5b5'],
                    description: "1bitpepperpalette"
                },
                "1bit green apple": {
                    colors: ['#000000', '#26c30f'],
                    description: "1bit green apple"
                }
            },
            "Other Systems": {
                "Commodore 64": {
                    colors: ['#000000', '#626262', '#898989', '#adadad', '#ffffff', '#9f4e44', '#cb7e75', '#6d5412', '#a1683c', '#c9d487', '#9ae29b', '#5cab5e', '#6abfc6', '#887ecb', '#50459b', '#a057a3'],
                    description: "Commodore 64"
                },
                "NES Standard": {
                    colors: ['#7C7C7C', '#0000FC', '#0000BC', '#4428BC', '#940084', '#A80020', '#A81000', '#881400'],
                    description: "Standard NES palette"
                },
                "CGA": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA', '#555555', '#5555FF', '#55FF55', '#55FFFF', '#FF5555', '#FF55FF', '#FFFF55', '#FFFFFF'],
                    description: "CGA"
                },
                "Ocean": {
                    colors: ['#FFFFFF', '#7B7BFF', '#00007B', '#000000', '#00FFFF', '#0000FF', '#000094', '#000000'],
                    description: "Ocean-themed palette"
                },
                "TurboGrafx16": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA', '#555555', '#5555FF', '#55FF55', '#55FFFF', '#FF5555', '#FF55FF', '#FFFF55', '#FFFFFF'],
                    description: "TurboGrafx-16 Palette"
                },
                "Vic-20": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA'],
                    description: "Vic-20 Palette"
                },
                "MacintoshII": {
                    colors: ['#000000', '#FFFFFF', '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#808080', '#C0C0C0', '#FF8080', '#80FF80', '#8080FF', '#FFFF80', '#FF80FF', '#80FFFF'],
                    description: "Macintosh II Palette"
                },
                "Intellivision": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA'],
                    description: "Intellivision Palette"
                },
                "ZX-Spectrum": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA', '#555555', '#5555FF', '#55FF55', '#55FFFF', '#FF5555', '#FF55FF', '#FFFF55', '#FFFFFF'],
                    description: "ZX-Spectrum Palette"
                },
                "SECAM": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA', '#555555', '#5555FF', '#55FF55', '#55FFFF', '#FF5555', '#FF55FF', '#FFFF55', '#FFFFFF'],
                    description: "SECAM Palette"
                },
                "MasterSystem": {
                    colors: ['#000000', '#0000AA', '#00AA00', '#00AAAA', '#AA0000', '#AA00AA', '#AA5500', '#AAAAAA', '#555555', '#5555FF', '#55FF55', '#55FFFF', '#FF5555', '#FF55FF', '#FFFF55', '#FFFFFF'],
                    description: "Master System Palette"
                }
            },
            "Game Boy Color": {
                "Default": {
                    colors: ['#FFFFFF', '#ADAD84', '#42737B', '#000000', '#FFFF7B', '#FF5A00', '#943A00', '#000000'],
                    description: "8-color default palette"
                },
                "Nature": {
                    colors: ['#FFFFFF', '#7BFF00', '#007B00', '#000000', '#FFFF00', '#FF0000', '#940000', '#000000'],
                    description: "Nature-themed palette"
                },
                "Ocean": {
                    colors: ['#FFFFFF', '#7B7BFF', '#00007B', '#000000', '#00FFFF', '#0000FF', '#000094', '#000000'],
                    description: "Ocean-themed palette"
                }
            },
            "Pretty Palettes": {
                "Pastel Dreams": {
                    colors: ['#D7BDE2', '#A9CCE3', '#A3E4D7', '#F9E79F'],
                    description: "Soft pastel colors for a dreamy atmosphere."
                },
                "Forest Walk": {
                    colors: ['#27AE60', '#16A085', '#D35400', '#8E44AD'],
                    description: "Earthy greens and a pop of orange for a nature vibe."
                },
                "Rgr papercut4": {
                    colors: ['#0c0c0d', '#3f3d47', '#8b7d73', '#cdb27b'],
                    description: "papercut ."
                },
                "Sunset Hues": {
                    colors: ['#F1C40F', '#E67E22', '#E74C3C', '#9B59B6'],
                    description: "Warm colors inspired by a beautiful sunset."
                },
                "Ocean Depths": {
                    colors: ['#1B4F72', '#2980B9', '#3498DB', '#AED6F1'],
                    description: "Varying shades of blue for an underwater feel."
                },
                "Nib-Bit": {
                    colors: ['#000000', '#1b1233', '#00AA00', '#dcf29d'],
                    description: "1 bit"
                },
                "Retro Vibes": {
                    colors: ['#F39C12', '#E74C3C', '#3498DB', '#2ECC71'],
                    description: "Bold and bright colors with a retro touch."
                }
            },
            "lospec": {
                "Autumn": {
                    colors: ['#2b2303', '#933513', '#ef975d', '#fffbd1'],
                    description: "Autumn"
                },
                "GBREMIXED2": {
                    colors: ['#1b253d', '#377a64', '#9aad5c', '#e3e2d5'],
                    description: "GBREMIXED2"
                },
                "CMYK - SNURLY": {
                    colors: ['#35cbc8', '#c93864', '#ffdb85', '#1b192a'],
                    description: "CMYK - SNURLY"
                },
                "virtual boy": {
                    colors: ['#ef0000', '#a40000', '#550000', '#000000'],
                    description: "virtual boy"
                },
                "Game&Watch": {
                    colors: ['#06160f', '#535b4e', '#b0b3a6', '#efeee8'],
                    description: "Game&Watch"
                },
                "RedRose": {
                    colors: ['#260f0d', '#591616', '#991f27', '#cc3d50'],
                    description: "RedRose"
                },
                "Calico": {
                    colors: ['#efebdf', '#e8a053', '#936a4e', '#381701'],
                    description: "Calico"
                },
                "Avalon": {
                    colors: ['#20759c', '#084062', '#002841', '#000408'],
                    description: "Avalon"
                },
                "MIKYU": {
                    colors: ['#111451', '#796095', '#7ddcc9', '#ffe5ff'],
                    description: "MIKYU"
                },
                "Aether Quartet": {
                    colors: ['#d1d8ff', '#968f79', '#3c0197', '#2c0148'],
                    description: "Aether Quartet"
                },
                "RetroBlue": {
                    colors: ['#ced9ec', '#66b0c7', '#34419d'],
                    description: "RetroBlue"
                },
                "NightLight": {
                    colors: ['#0b0926', '#594f7d', '#cc9a6e', '#faf0b9'],
                    description: "NightLight"
                },
                "Perry Platypus": {
                    colors: ['#7fbfdf', '#f1f2f3', '#eca550', '#6f3530'],
                    description: "Perry Platypus"
                },
                "PICKLJUICE": {
                    colors: ['#3b1c24', '#4d5245', '#96b38f', '#f0e5d8'],
                    description: "PICKLJUICE"
                },
                "MOSSTONE": {
                    colors: ['#2e2f35', '#585460', '#93b987', '#fdf4e9'],
                    description: "MOSSTONE"
                },
                "bronze star": {
                    colors: ['#14305f', '#305f7b', '#bf9f00', '#cfaf5f'],
                    description: "bronze star"
                },
                "bumblebit": {
                    colors: ['#272946', '#eda031', '#e7ffee'],
                    description: "bumblebit"
                },
                "Anxietaas": {
                    colors: ['#ffee96', '#e08e49', '#842243', '#2c1415'],
                    description: "Anxietaas"
                },
                "Sunset Latern": {
                    colors: ['#523237', '#ab645a', '#e39b7f', '#f9cda6'],
                    description: "Sunset Latern"
                },
                "Minimal Red": {
                    colors: ['#fefefe', '#ed3237', '#373435'],
                    description: "Minimal Red"
                },
                "BlueSnow": {
                    colors: ['#a4a4a4', '#4b4b4b', '#8080ff'],
                    description: "BlueSnow"
                },
                "Taco Bell Table": {
                    colors: ['#266b90', '#9b63bf', '#e477b6', '#fff3f3'],
                    description: "Taco Bell Table"
                },
                "papertiger": {
                    colors: ['#191818', '#81634d', '#a5906d', '#d4c8bb'],
                    description: "papertiger"
                },
                "n-brulee": {
                    colors: ['#381a31', '#8e43a1', '#e9edff', '#caa860'],
                    description: "n-brulee"
                },
                "borealis": {
                    colors: ['#ffdbb6', '#db926d', '#496d6d', '#242449'],
                    description: "borealis"
                },
                "classic red": {
                    colors: ['#20181c', '#d84444', '#a23039', '#792336'],
                    description: "classic red"
                },
                "gb noodz": {
                    colors: ['#4c4139', '#9a747f', '#ccb4a4', '#e5dacd'],
                    description: "gb noodz"
                },
                "cold sweater": {
                    colors: ['#10081a', '#78a7f5', '#fcd19b', '#ffffff'],
                    description: "cold sweater"
                }
            },
            "lopsec 2": {
                "COLDGB": {
                    colors: ['#220022', '#334455', '#779988', '#ffffdd'],
                    description: "COLDGB"
                },
                "Propaganda": {
                    colors: ['#18181e', '#453d34', '#8f5b5b', '#bdafa8'],
                    description: "Propaganda"
                },
                "Gb-Armanita": {
                    colors: ['#662959', '#a56368', '#bfb1a2', '#f0ebd8'],
                    description: "Gb-Armanita"
                },
                "Homework": {
                    colors: ['#e1d8d4', '#878c9d', '#45568d', '#12121b'],
                    description: "Homework"
                },
                "HallowPal": {
                    colors: ['#4d1f00', '#9b32af', '#f06923', '#bbbab0'],
                    description: "HallowPal"
                },
                "lt greens": {
                    colors: ['#f4fbd0', '#68cf68', '#1e9178', '#05241f'],
                    description: "lt greens"
                },
                "eb gb banana": {
                    colors: ['#edf2b8', '#c4d23a', '#876a4e', '#382137'],
                    description: "eb gb banana"
                },
                "Naples": {
                    colors: ['#f7f6e2', '#ffd7c1', '#af9170', '#5f4b1f'],
                    description: "Naples"
                },
                "steampunk": {
                    colors: ['#bebc99', '#6f8b6c', '#4f485e', '#171a24'],
                    description: "steampunk"
                },
                "Optimized Greyscale": {
                    colors: ['#dfdfdf', '#9f9f9f', '#606060', '#202020'],
                    description: "Optimized Greyscale"
                },
                "LOSTGB": {
                    colors: ['#141319', '#30303d', '#7b7aa4', '#dadada'],
                    description: "LOSTGB"
                },
                "Sanguine": {
                    colors: ['#bba075', '#734940', '#641010', '#28000e'],
                    description: "Sanguine"
                },
                "TechnoBike": {
                    colors: ['#1d2938', '#2a616e', '#13b37e', '#07ef5c'],
                    description: "TechnoBike"
                },
                "BlueSemi": {
                    colors: ['#d0f4f8', '#70b0c0', '#3c3468', '#1c0820'],
                    description: "BlueSemi"
                },
                "Desat": {
                    colors: ['#291a1f', '#675650', '#bea87d', '#f0e0cf'],
                    description: "Desat"
                },
                "Vireo": {
                    colors: ['#27393f', '#6f535b', '#649092', '#cfc89d'],
                    description: "Vireo"
                },
                "Old Mug": {
                    colors: ['#f3eece', '#c0af90', '#3f5956', '#252b3a'],
                    description: "Old Mug"
                },
                "Gooseberry Thistle": {
                    colors: ['#48376c', '#6c56ab', '#b883b9', '#bfdce1'],
                    description: "Gooseberry Thistle"
                },
                "PEANUT BUTTER GB": {
                    colors: ['#e3e6c5', '#d98d3d', '#784141', '#38192d'],
                    description: "PEANUT BUTTER GB"
                },
                "MYSTIQUElIFE": {
                    colors: ['#502a45', '#816ea0', '#87bac5'],
                    description: "MYSTIQUElIFE"
                },
                "BlackTar": {
                    colors: ['#843c35', '#ffeb94', '#398a75', '#26153a'],
                    description: "BlackTar"
                },
                "Droplets": {
                    colors: ['#0b1424', '#25375c', '#5c7391', '#aec3d6'],
                    description: "Droplets"
                },
                "Sunrise": {
                    colors: ['#171726', '#804055', '#d99d62', '#fff2d9'],
                    description: "Sunrise"
                },
                "grapetree": {
                    colors: ['#cfb690', '#845a78', '#4c4138', '#17072b'],
                    description: "grapetree"
                },
                "M≈ìbius": {
                    colors: ['#f1e0cd', '#ffa49a', '#da3467', '#35333f'],
                    description: "M≈ìbius"
                },
                "bloodlust": {
                    colors: ['#382637', '#782f51', '#c33149', '#dea257'],
                    description: "bloodlust"
                },
                "Weekly Release": {
                    colors: ['#cccec7', '#a09f97', '#77746f', '#2e2622'],
                    description: "Weekly Release"
                },
                "BMO": {
                    colors: ['#101e2b', '#183a42', '#407c84', '#8bbe93'],
                    description: "BMO"
                },
                "DMG-01": {
                    colors: ['#1b2a09', '#0e450b', '#496b22', '#9a9e3f'],
                    description: "DMG-01"
                },
                "MINTGB": {
                    colors: ['#f4f2af', '#64d0b8', '#3b7961', '#291f3e'],
                    description: "MINTGB"
                },
                "YOGHURT": {
                    colors: ['#39254e', '#5951bb', '#d765bf', '#d5a2e2'],
                    description: "YOGHURT"
                },
                "SLATE - SNURLY": {
                    colors: ['#beb09f', '#608189', '#49556c', '#292736'],
                    description: "SLATE - SNURLY"
                },
                "mononoke": {
                    colors: ['#03324e', '#c74148', '#dbb9a0', '#ffffff'],
                    description: "mononoke"
                },
                "AGB2": {
                    colors: ['#1e4959', '#3ba155', '#a0c76f', '#ebe0b2'],
                    description: "AGB2"
                },
                "1 bit monitor glow": {
                    colors: ['#222323', '#f0f6f0'],
                    description: "1 bit monitor glow"
                },
                "Ice Cream GB Palette": {
                    colors: ['#7c3f58', '#eb6b6f', '#f9a875', '#fff6d3'],
                    description: "Ice Cream GB Palette"
                },
                "LAVA GB": {
                    colors: ['#051f39', '#4a2480', '#c53a9d', '#ff8e80'],
                    description: "LAVA GB"
                },
                "DEMICHROME": {
                    colors: ['#211e20', '#555568', '#a0a08b', '#e9efec'],
                    description: "DEMICHROME"
                },
                "MOONLIGHT GB": {
                    colors: ['#0f052d', '#203671', '#36868f', '#5fc75d'],
                    description: "MOONLIGHT GB"
                },
                "HOLLOWKNIGHT": {
                    colors: ['#0f0f1b', '#565a75', '#c6b7be', '#fafbf6'],
                    description: "HOLLOWKNIGHT"
                },
                "BITBEE": {
                    colors: ['#292b30', '#cfab4a'],
                    description: "BITBEE"
                },
                "SPACE HAZE": {
                    colors: ['#f8e3c4', '#cc3495', '#6b1fb1', '#0b0630'],
                    description: "SPACE HAZE"
                },
                "BitterSweet": {
                    colors: ['#282328', '#545c7e', '#c56981', '#a3a29a'],
                    description: "BitterSweet"
                },
                "BLK-Aqua": {
                    colors: ['#002b59', '#005f8c', '#00b9be', '#9ff4e5'],
                    description: "BLK-Aqua"
                },
                "NostalgiaGB": {
                    colors: ['#d0d058', '#a0a840', '#708028', '#405010'],
                    description: "NostalgiaGB"
                },
                "HALLOWEEN": {
                    colors: ['#300030', '#602878', '#f89020', '#f8f088'],
                    description: "HALLOWEEN"
                },
                "DUSTBYTE": {
                    colors: ['#788374', '#f5e9bf', '#aa644d', '#372a39'],
                    description: "DUSTBYTE"
                },
                "COLDFIREGB": {
                    colors: ['#46425e', '#5b768d', '#d17c7c', '#f6c6a8'],
                    description: "COLDFIREGB"
                },
                "HOUND": {
                    colors: ['#3c1402', '#ca9a57', '#e96f1b', '#312b24'],
                    description: "HOUND"
                },
                "CRIMSON": {
                    colors: ['#eff9d6', '#ba5044', '#7a1c4b', '#1b0326'],
                    description: "CRIMSON"
                },
                "MuddySand": {
                    colors: ['#e6d69c', '#b4a56a', '#7b7162', '#393829'],
                    description: "MuddySand"
                },
                "ST GAMEBOy": {
                    colors: ['#09091a', '#442a8c', '#a8bf4c', '#f4f5e9'],
                    description: "ST GAMEBOY"
                },
                "2bit Pips": {
                    colors: ['#3a3522', '#7c3838', '#647859', '#b5a37e'],
                    description: "2bit Pips"
                },
                "Monday 4": {
                    colors: ['#ac8876', '#906776', '#634d69', '#353546'],
                    description: "Monday 4"
                },
                "DreamfulSpace": {
                    colors: ['#21193c', '#932f7b', '#e67b8b', '#f5d2b8'],
                    description: "DreamfulSpace"
                },
                "Snowflake 4": {
                    colors: ['#e7edeb', '#8ecece', '#62a1c7', '#3f6ecc'],
                    description: "Snowflake 4"
                },
                "WISH": {
                    colors: ['#622e4c', '#7550e8', '#608fcf', '#8be5ff'],
                    description: "WISH"
                },
                "Luxa": {
                    colors: ['#1e1e3c', '#50506e', '#bebee6', '#e6e6ff'],
                    description: "Luxa"
                },
                "LemonLime": {
                    colors: ['#28375b', '#39809c', '#5fcc86', '#fff37b'],
                    description: "LemonLime"
                },
                "RUSTIC": {
                    colors: ['#2c2137', '#764462', '#edb4a1', '#a96868'],
                    description: "RUSTIC"
                },
                "MISTGB": {
                    colors: ['#2d1b00', '#1e606e', '#5ab9a8', '#c4f0c2'],
                    description: "MISTGB"
                },
                "2bitdemi": {
                    colors: ['#211e20', '#555568', '#a0a08b', '#e9efec'],
                    description: "2bitdemi"
                },
                "HEY": {
                    colors: ['#1880f8', '#151515', '#ff82ce', '#ffe737'],
                    description: "HEY"
                },
                "ButI": {
                    colors: ['#000000', '#2234d1', '#aa0000', '#aaaaaa'],
                    description: "ButI"
                },
                "LOSPEC": {
                    colors: ['#000000', '#382843', '#7c6d80', '#c7c6c6'],
                    description: "LOSPEC"
                },
                "REDBLOODPAIN": {
                    colors: ['#7e1f23', '#c4181f', '#120a19', '#5e4069'],
                    description: "REDBLOODPAIN"
                },
                "PEPNO": {
                    colors: ['#101323', '#d6d4cb', '#711919'],
                    description: "PEPNO"
                },
                "bicycle": {
                    colors: ['#161616', '#ab4646', '#8f9bf6', '#f0f0f0'],
                    description: "bicycle"
                },
                "BLUEMOLD": {
                    colors: ['#191b1a', '#294257', '#579c9a', '#99c9b3'],
                    description: "BLUEMOLD"
                },
                "GOLDGB": {
                    colors: ['#210b1b', '#4d222c', '#9d654c', '#cfab51'],
                    description: "GOLDGB"
                },
                "FIERYPLAGUE": {
                    colors: ['#1a2129', '#312137', '#512839', '#713141'],
                    description: "FIERYPLAGUE"
                },
                "moonccrystal": {
                    colors: ['#ffe2db', '#d9a7c6', '#8d89c7', '#755f9c'],
                    description: "moonccrystal"
                },
                "kaneik4": {
                    colors: ['#ffffff', '#f42e1f', '#2f256b', '#060608'],
                    description: "kaneik4"
                },
                "AMERICANA": {
                    colors: ['#fce4a8', '#71969f', '#d71a21', '#01334e'],
                    description: "AMERICANA"
                },
                "PASTLITO": {
                    colors: ['#4b475c', '#d7dedc'],
                    description: "PASTLITO"
                }
            },
            "Horror": {
                "purpledawn": {
                    colors: ['#eefded', '#9a7bbc', '#2d757e', '#001b2e'],
                    description: "purpledawn"
                },
                "rising sunset": {
                    colors: ['#181322', '#4b372c', '#a2423a', '#cdc1a7'],
                    description: "rising sunset"
                },
                "amber crt gb": {
                    colors: ['#0d0405', '#5e1210', '#d35600', '#fed018'],
                    description: "amber crt gb"
                },
                "empty space": {
                    colors: ['#000100', '#431723', '#46464f', '#928e80'],
                    description: "empty space"
                },
                "voltage warning": {
                    colors: ['#1c1412', '#635650', '#d3ae21', '#d4c9c3'],
                    description: "voltage warning"
                },
                "look of horror": {
                    colors: ['#0a202f', '#302d6a', '#871c3e', '#d32836'],
                    description: "look of horror"
                },
                "Vivid Sceam": {
                    colors: ['#561d17', '#5c4fa3', '#74af34', '#caf532'],
                    description: "Vivid Sceam"
                },
                "BarbieSlasher": {
                    colors: ['#000000', '#6e1fb1', '#cc3385', '#f8fbf3'],
                    description: "BarbieSlasher"
                },
                "Mushroom": {
                    colors: ['#2b4158', '#8b6f7b', '#caaea3', '#fff9f1'],
                    description: "Mushroom"
                },
                "MokkyBrown": {
                    colors: ['#cca66e', '#99683d', '#664930', '#332920'],
                    description: "MokkyBrown"
                },
                "Candy Pop": {
                    colors: ['#301221', '#854576', '#9e81d0', '#eebff5'],
                    description: "Candy Pop"
                },
                "Caramel Autumn": {
                    colors: ['#290143', '#a22fc9', '#ff8b40', '#fff4b8'],
                    description: "Caramel Autumn"
                },
                "BlushGB": {
                    colors: ['#b03e80', '#ff8acd', '#4aedff', '#ffffff'],
                    description: "BlushGB"
                },
                "mangavania": {
                    colors: ['#fe9192', '#fcdebe', '#0cc0d4', '#5e5768'],
                    description: "mangavania"
                },
                "STARPOP": {
                    colors: ['#674577', '#64b9ca', '#ffa3d6', '#ffebe5'],
                    description: "STARPOP"
                },
                "Triple Fin": {
                    colors: ['#ffcfb9', '#ffaec9', '#fe5ba9', '#b01550'],
                    description: "Triple Fin"
                },
                "Italy": {
                    colors: ['#100f24', '#5d8d60', '#edeada', '#c74634'],
                    description: "Italy"
                },
                "Black-White": {
                    colors: ['#000000', '#FFFFFF'],
                    description: "Simple black and white"
                }
            }
        };

        let selectedFiles = [];
        let convertedImages = [];
        
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const convertBtn = document.getElementById('convertBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const status = document.getElementById('status');
        const progress = document.getElementById('progress');
        const previewContainer = document.getElementById('previewContainer');
        const originalPreview = document.getElementById('originalPreview');
        const convertedPreview = document.getElementById('convertedPreview');
        const consoleSelect = document.getElementById('console');
        const paletteSelect = document.getElementById('palette');
        const palettePreview = document.getElementById('palettePreview');

        // Initialize palette preview
        function updatePalettePreview() {
            const console = consoleSelect.value;
            const palette = paletteSelect.value;
            const colors = PALETTES[console][palette].colors;
            
            palettePreview.innerHTML = colors.map(color => 
                `<div class="palette-color" style="background-color: ${color}"></div>`
            ).join('');
        }

        // Hex to RGB conversion
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        // Optimized palette conversion using ImageData
        function convertImageToPalette(imageData, paletteColors) {
            const data = imageData.data;
            const palette = paletteColors.map(hexToRgb);
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Find closest color
                let minDist = Infinity;
                let closestColor = palette[0];
                
                for (const color of palette) {
                    const dist = Math.pow(r - color.r, 2) + 
                                Math.pow(g - color.g, 2) + 
                                Math.pow(b - color.b, 2);
                    if (dist < minDist) {
                        minDist = dist;
                        closestColor = color;
                    }
                }
                
                data[i] = closestColor.r;
                data[i + 1] = closestColor.g;
                data[i + 2] = closestColor.b;
            }
            
            return imageData;
        }

        // Process image
        async function processImage(file) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const console = consoleSelect.value;
                        const palette = paletteSelect.value;
                        const colors = PALETTES[console][palette].colors;
                        
                        const convertedData = convertImageToPalette(imageData, colors);
                        ctx.putImageData(convertedData, 0, 0);
                        
                        canvas.toBlob((blob) => {
                            resolve({
                                name: file.name,
                                blob: blob,
                                url: URL.createObjectURL(blob),
                                originalUrl: e.target.result
                            });
                        }, 'image/png');
                    };
                    img.src = e.target.result;
                };
                
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Show status message
        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
        }

        // Hide status
        function hideStatus() {
            status.classList.add('hidden');
        }

        // Handle file selection
        function handleFiles(files) {
            selectedFiles = Array.from(files).filter(f => f.type.startsWith('image/'));
            
            if (selectedFiles.length > 0) {
                convertBtn.disabled = false;
                showStatus(`${selectedFiles.length} image(s) selected`, 'info');
                
                // Show preview for first image
                const reader = new FileReader();
                reader.onload = (e) => {
                    originalPreview.src = e.target.result;
                    previewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(selectedFiles[0]);
            } else {
                showStatus('No valid image files selected', 'error');
            }
        }

        // Convert images
        async function convertImages() {
            if (selectedFiles.length === 0) return;
            
            convertBtn.disabled = true;
            downloadBtn.classList.add('hidden');
            progress.classList.remove('hidden');
            progress.value = 0;
            convertedImages = [];
            
            showStatus('Converting images...', 'info');
            
            for (let i = 0; i < selectedFiles.length; i++) {
                try {
                    const result = await processImage(selectedFiles[i]);
                    convertedImages.push(result);
                    
                    if (i === 0) {
                        convertedPreview.src = result.url;
                    }
                    
                    progress.value = ((i + 1) / selectedFiles.length) * 100;
                } catch (error) {
                    console.error('Error processing image:', error);
                }
            }
            
            progress.classList.add('hidden');
            showStatus(`Successfully converted ${convertedImages.length} image(s)!`, 'success');
            convertBtn.disabled = false;
            
            if (convertedImages.length > 0) {
                downloadBtn.classList.remove('hidden');
            }
        }

        // Download single or multiple images
        function downloadImages() {
            const console = consoleSelect.value.replace(/\s+/g, '-');
            const palette = paletteSelect.value.replace(/\s+/g, '-');
            
            convertedImages.forEach((img, index) => {
                const link = document.createElement('a');
                const baseName = img.name.replace(/\.[^/.]+$/, '');
                link.download = `${baseName}_${console}_${palette}.png`;
                link.href = img.url;
                link.click();
            });
            
            showStatus('Download started!', 'success');
        }

        // Event listeners
        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
        
        convertBtn.addEventListener('click', convertImages);
        downloadBtn.addEventListener('click', downloadImages);
        
        paletteSelect.addEventListener('change', updatePalettePreview);
        consoleSelect.addEventListener('change', () => {
            // Update palette dropdown based on selected console
            const console = consoleSelect.value;
            const palettes = Object.keys(PALETTES[console]);
            paletteSelect.innerHTML = '';
            palettes.forEach(palette => {
                const option = document.createElement('option');
                option.value = palette;
                option.textContent = palette;
                paletteSelect.appendChild(option);
            });
            updatePalettePreview();
        });

        // Initialize console dropdown
        const consoles = Object.keys(PALETTES);
        consoleSelect.innerHTML = '';
        consoles.forEach(console => {
            const option = document.createElement('option');
            option.value = console;
            option.textContent = console;
            consoleSelect.appendChild(option);
        });
        
        // Trigger initial setup
        consoleSelect.dispatchEvent(new Event('change'));
        updatePalettePreview();
    </script>
</body>
</html>